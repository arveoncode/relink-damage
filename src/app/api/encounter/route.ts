import prisma from "@/db/prisma";
import { Encounter, Prisma } from "@prisma/client";
import {
  CharacterType,
  EncounterState,
  PlayerData,
  SkillState,
} from "@/types/logs.types";
import { NextRequest, NextResponse } from "next/server";
import { json } from "@/lib/utils";

//only route that is open to gbfr-logs
const getCorsHeaders = (origin: string) => {
  // Default options
  const headers = {
    "Access-Control-Allow-Methods": "POST",
    "Access-Control-Allow-Headers": "Content-Type, Authorization",
    "Access-Control-Allow-Origin": "http://localhost:1420",
  };

  // If no allowed origin is set to default server origin
  if (!process.env.ALLOWED_ORIGIN || !origin) return headers;

  // If allowed origin is set, check if origin is in allowed origins
  const allowedOrigins = process.env.ALLOWED_ORIGIN.split(",");

  // Validate server origin
  if (allowedOrigins.includes("*")) {
    headers["Access-Control-Allow-Origin"] = "*";
  } else if (allowedOrigins.includes(origin)) {
    headers["Access-Control-Allow-Origin"] = origin;
  }

  // Return result
  return headers;
};

// Endpoints
// ========================================================
/**
 * Basic OPTIONS Request to simuluate OPTIONS preflight request for mutative requests
 */
export const OPTIONS = async (request: NextRequest) => {
  // Return Response
  return NextResponse.json(
    {},
    {
      status: 200,
      headers: getCorsHeaders(request.headers.get("origin") || ""),
    }
  );
};

export async function GET(request: Request) {
  const getEncounters: Encounter[] | null = await prisma.encounter.findMany({
    // include: { party: false },
  });
  return NextResponse.json(
    {
      data: json(getEncounters),
    },
    {
      status: 200,
      headers: getCorsHeaders(request.headers.get("origin") || ""),
    }
  );
}

interface EncounterRequest {
  encounter: EncounterState;
  partyData: Array<PlayerData | null>;
}
export async function POST(request: Request) {
  const data = (await request.json()) as EncounterRequest;

  const party = Object.entries(data.encounter.party).map(([k, v]) => ({
    index: parseInt(k),
    characterType: v.characterType as string,
    totalDamage: v.totalDamage,
    dps: v.dps,
    skillBreakdown: v.skillBreakdown as SkillState[],
  }));

  const createEncounter = await prisma.encounter.create({
    data: {
      startTime: data.encounter.startTime,
      endTime: data.encounter.endTime,
      totalDamage: data.encounter.totalDamage,
      dps: data.encounter.dps,
      targets: data.encounter.targets,
      party: {
        create: party,
      },
    },
  });
  return NextResponse.json(
    {
      data: json(createEncounter),
    },
    {
      status: 200,
      headers: getCorsHeaders(request.headers.get("origin") || ""),
    }
  );
}

// sample full encounter
// const partydata = [
//   {
//     actorIndex: 403,
//     displayName: "Arveon",
//     characterName: "Charlotta",
//     characterType: "Pl1200",
//     sigils: [
//       {
//         firstTraitId: 2594029936,
//         firstTraitLevel: 15,
//         secondTraitId: 1911626395,
//         secondTraitLevel: 15,
//         sigilId: 2700693353,
//         equippedCharacter: 4248560482,
//         sigilLevel: 15,
//         acquisitionCount: 15054,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 1280871463,
//         firstTraitLevel: 15,
//         secondTraitId: 2289754288,
//         secondTraitLevel: 15,
//         sigilId: 3666949793,
//         equippedCharacter: 4248560482,
//         sigilLevel: 15,
//         acquisitionCount: 3629,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 2812567336,
//         firstTraitLevel: 15,
//         secondTraitId: 99806428,
//         secondTraitLevel: 15,
//         sigilId: 319097004,
//         equippedCharacter: 4248560482,
//         sigilLevel: 15,
//         acquisitionCount: 6259,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 3696775008,
//         firstTraitLevel: 15,
//         secondTraitId: 831329001,
//         secondTraitLevel: 15,
//         sigilId: 1423501828,
//         equippedCharacter: 4248560482,
//         sigilLevel: 15,
//         acquisitionCount: 12810,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 1552297491,
//         firstTraitLevel: 14,
//         secondTraitId: 3696775008,
//         secondTraitLevel: 14,
//         sigilId: 1144547182,
//         equippedCharacter: 4248560482,
//         sigilLevel: 14,
//         acquisitionCount: 15501,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 1552297491,
//         firstTraitLevel: 14,
//         secondTraitId: 3696775008,
//         secondTraitLevel: 14,
//         sigilId: 1144547182,
//         equippedCharacter: 4248560482,
//         sigilLevel: 14,
//         acquisitionCount: 15502,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 2373493147,
//         firstTraitLevel: 15,
//         secondTraitId: 3696775008,
//         secondTraitLevel: 15,
//         sigilId: 196723080,
//         equippedCharacter: 4248560482,
//         sigilLevel: 15,
//         acquisitionCount: 13724,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 4051194041,
//         firstTraitLevel: 15,
//         secondTraitId: 612907763,
//         secondTraitLevel: 15,
//         sigilId: 1782261331,
//         equippedCharacter: 4248560482,
//         sigilLevel: 15,
//         acquisitionCount: 5368,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 801700863,
//         firstTraitLevel: 15,
//         secondTraitId: 3868870292,
//         secondTraitLevel: 15,
//         sigilId: 3896853593,
//         equippedCharacter: 4248560482,
//         sigilLevel: 15,
//         acquisitionCount: 9483,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 15,
//         secondTraitId: 2515794566,
//         secondTraitLevel: 15,
//         sigilId: 56249821,
//         equippedCharacter: 4248560482,
//         sigilLevel: 15,
//         acquisitionCount: 2696,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 15,
//         secondTraitId: 2335962636,
//         secondTraitLevel: 15,
//         sigilId: 56249821,
//         equippedCharacter: 4248560482,
//         sigilLevel: 15,
//         acquisitionCount: 7745,
//         notificationEnum: 3,
//       },
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 15,
//         secondTraitId: 2289754288,
//         secondTraitLevel: 15,
//         sigilId: 1119554588,
//         equippedCharacter: 4248560482,
//         sigilLevel: 15,
//         acquisitionCount: 8476,
//         notificationEnum: 3,
//       },
//     ],
//     isOnline: false,
//     weaponInfo: {
//       weaponId: 2222708081,
//       starLevel: 6,
//       plusMarks: 99,
//       awakeningLevel: 10,
//       trait1Id: 2373493147,
//       trait1Level: 10,
//       trait2Id: 1327117955,
//       trait2Level: 7,
//       trait3Id: 99806428,
//       trait3Level: 4,
//       wrightstoneId: 752853394,
//       weaponLevel: 150,
//       weaponHp: 99,
//       weaponAttack: 2285,
//     },
//     overmasteryInfo: {
//       overmasteries: [
//         { id: 1170626407, flags: 512, value: 20 },
//         { id: 2622837811, flags: 512, value: 20 },
//         { id: 3297926103, flags: 512, value: 1000 },
//         { id: 1136089117, flags: 512, value: 20 },
//       ],
//     },
//     playerStats: {
//       level: 100,
//       totalHp: 30142,
//       totalAttack: 27328,
//       stunPower: 13,
//       criticalRate: 100,
//       totalPower: 22733,
//     },
//   },
//   {
//     actorIndex: 421,
//     displayName: "Shxryl",
//     characterName: "Shxryl",
//     characterType: "Pl1400",
//     sigils: [
//       {
//         firstTraitId: 699431915,
//         firstTraitLevel: 15,
//         secondTraitId: 2788919757,
//         secondTraitLevel: 15,
//         sigilId: 441954033,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 2373493147,
//         firstTraitLevel: 15,
//         secondTraitId: 801700863,
//         secondTraitLevel: 15,
//         sigilId: 1167971010,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1911626395,
//         firstTraitLevel: 11,
//         secondTraitId: 831329001,
//         secondTraitLevel: 11,
//         sigilId: 2761097132,
//         equippedCharacter: 2289754288,
//         sigilLevel: 11,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 3696775008,
//         firstTraitLevel: 11,
//         secondTraitId: 831329001,
//         secondTraitLevel: 11,
//         sigilId: 1423501828,
//         equippedCharacter: 2289754288,
//         sigilLevel: 11,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 3696775008,
//         firstTraitLevel: 11,
//         secondTraitId: 831329001,
//         secondTraitLevel: 11,
//         sigilId: 1423501828,
//         equippedCharacter: 2289754288,
//         sigilLevel: 11,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 3696775008,
//         firstTraitLevel: 11,
//         secondTraitId: 99806428,
//         secondTraitLevel: 11,
//         sigilId: 1423501828,
//         equippedCharacter: 2289754288,
//         sigilLevel: 11,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 3696775008,
//         firstTraitLevel: 11,
//         secondTraitId: 342947936,
//         secondTraitLevel: 11,
//         sigilId: 1423501828,
//         equippedCharacter: 2289754288,
//         sigilLevel: 11,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1280871463,
//         firstTraitLevel: 15,
//         secondTraitId: 2289754288,
//         secondTraitLevel: 15,
//         sigilId: 3666949793,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 11,
//         secondTraitId: 2289754288,
//         secondTraitLevel: 11,
//         sigilId: 1119554588,
//         equippedCharacter: 2289754288,
//         sigilLevel: 11,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 11,
//         secondTraitId: 2289754288,
//         secondTraitLevel: 11,
//         sigilId: 1119554588,
//         equippedCharacter: 2289754288,
//         sigilLevel: 11,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 453875863,
//         firstTraitLevel: 15,
//         secondTraitId: 2289754288,
//         secondTraitLevel: 15,
//         sigilId: 4177457924,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 4051194041,
//         firstTraitLevel: 11,
//         secondTraitId: 612907763,
//         secondTraitLevel: 11,
//         sigilId: 1782261331,
//         equippedCharacter: 2289754288,
//         sigilLevel: 11,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//     ],
//     isOnline: true,
//     weaponInfo: {
//       weaponId: 2756620724,
//       starLevel: 6,
//       plusMarks: 99,
//       awakeningLevel: 10,
//       trait1Id: 2373493147,
//       trait1Level: 10,
//       trait2Id: 3053428691,
//       trait2Level: 6,
//       trait3Id: 612907763,
//       trait3Level: 4,
//       wrightstoneId: 2289754288,
//       weaponLevel: 150,
//       weaponHp: 99,
//       weaponAttack: 2285,
//     },
//     overmasteryInfo: {
//       overmasteries: [
//         { id: 2622837811, flags: 128, value: 12 },
//         { id: 1823706867, flags: 512, value: 2 },
//         { id: 1136089117, flags: 512, value: 20 },
//         { id: 1170626407, flags: 512, value: 20 },
//       ],
//     },
//     playerStats: {
//       level: 100,
//       totalHp: 36182,
//       totalAttack: 23986,
//       stunPower: 15,
//       criticalRate: 100,
//       totalPower: 21562,
//     },
//   },
//   {
//     actorIndex: 439,
//     displayName: "Okita Sōji",
//     characterName: "Okita Sōji",
//     characterType: "Pl0800",
//     sigils: [
//       {
//         firstTraitId: 3689011061,
//         firstTraitLevel: 15,
//         secondTraitId: 3696775008,
//         secondTraitLevel: 15,
//         sigilId: 2451411160,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 3689011061,
//         firstTraitLevel: 15,
//         secondTraitId: 3696775008,
//         secondTraitLevel: 15,
//         sigilId: 2451411160,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 3696775008,
//         firstTraitLevel: 15,
//         secondTraitId: 612907763,
//         secondTraitLevel: 15,
//         sigilId: 1423501828,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 2373493147,
//         firstTraitLevel: 15,
//         secondTraitId: 4051194041,
//         secondTraitLevel: 15,
//         sigilId: 196723080,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 801700863,
//         firstTraitLevel: 15,
//         secondTraitId: 3536380170,
//         secondTraitLevel: 15,
//         sigilId: 3896853593,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1911626395,
//         firstTraitLevel: 15,
//         secondTraitId: 831329001,
//         secondTraitLevel: 15,
//         sigilId: 2761097132,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 15,
//         secondTraitId: 3536380170,
//         secondTraitLevel: 15,
//         sigilId: 56249821,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 15,
//         secondTraitId: 2335962636,
//         secondTraitLevel: 15,
//         sigilId: 56249821,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 15,
//         secondTraitId: 3053428691,
//         secondTraitLevel: 15,
//         sigilId: 56249821,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 3961284473,
//         firstTraitLevel: 15,
//         secondTraitId: 3053428691,
//         secondTraitLevel: 15,
//         sigilId: 172380603,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1280871463,
//         firstTraitLevel: 15,
//         secondTraitId: 2289754288,
//         secondTraitLevel: 15,
//         sigilId: 3666949793,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 2363462530,
//         firstTraitLevel: 15,
//         secondTraitId: 3506515340,
//         secondTraitLevel: 15,
//         sigilId: 3785038181,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//     ],
//     isOnline: true,
//     weaponInfo: {
//       weaponId: 2683994299,
//       starLevel: 6,
//       plusMarks: 99,
//       awakeningLevel: 10,
//       trait1Id: 2373493147,
//       trait1Level: 10,
//       trait2Id: 3696775008,
//       trait2Level: 7,
//       trait3Id: 3696775008,
//       trait3Level: 5,
//       wrightstoneId: 2289754288,
//       weaponLevel: 150,
//       weaponHp: 99,
//       weaponAttack: 2285,
//     },
//     overmasteryInfo: {
//       overmasteries: [
//         { id: 1823706867, flags: 512, value: 2 },
//         { id: 1170626407, flags: 512, value: 20 },
//         { id: 3412311637, flags: 512, value: 1000 },
//         { id: 1756598296, flags: 512, value: 20 },
//       ],
//     },
//     playerStats: {
//       level: 100,
//       totalHp: 30193,
//       totalAttack: 13664,
//       stunPower: 15,
//       criticalRate: 100,
//       totalPower: 20347,
//     },
//   },
//   {
//     actorIndex: 456,
//     displayName: "afox",
//     characterName: "afox",
//     characterType: "Pl0300",
//     sigils: [
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 15,
//         secondTraitId: 831329001,
//         secondTraitLevel: 15,
//         sigilId: 56249821,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 15,
//         secondTraitId: 99806428,
//         secondTraitLevel: 15,
//         sigilId: 56249821,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1470847760,
//         firstTraitLevel: 15,
//         secondTraitId: 612907763,
//         secondTraitLevel: 15,
//         sigilId: 56249821,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 3689011061,
//         firstTraitLevel: 15,
//         secondTraitId: 3696775008,
//         secondTraitLevel: 15,
//         sigilId: 2451411160,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 3689011061,
//         firstTraitLevel: 15,
//         secondTraitId: 3696775008,
//         secondTraitLevel: 15,
//         sigilId: 2451411160,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1552297491,
//         firstTraitLevel: 15,
//         secondTraitId: 3696775008,
//         secondTraitLevel: 15,
//         sigilId: 1144547182,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1552297491,
//         firstTraitLevel: 15,
//         secondTraitId: 3696775008,
//         secondTraitLevel: 15,
//         sigilId: 1144547182,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 2373493147,
//         firstTraitLevel: 15,
//         secondTraitId: 801700863,
//         secondTraitLevel: 15,
//         sigilId: 1167971010,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 3009445917,
//         firstTraitLevel: 15,
//         secondTraitId: 3697311093,
//         secondTraitLevel: 15,
//         sigilId: 3083096922,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 4051194041,
//         firstTraitLevel: 15,
//         secondTraitId: 2335962636,
//         secondTraitLevel: 15,
//         sigilId: 1782261331,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 1280871463,
//         firstTraitLevel: 15,
//         secondTraitId: 2289754288,
//         secondTraitLevel: 15,
//         sigilId: 3666949793,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//       {
//         firstTraitId: 354305652,
//         firstTraitLevel: 15,
//         secondTraitId: 2742353392,
//         secondTraitLevel: 15,
//         sigilId: 2561069641,
//         equippedCharacter: 2289754288,
//         sigilLevel: 15,
//         acquisitionCount: 0,
//         notificationEnum: 0,
//       },
//     ],
//     isOnline: true,
//     weaponInfo: {
//       weaponId: 2069723170,
//       starLevel: 6,
//       plusMarks: 99,
//       awakeningLevel: 10,
//       trait1Id: 2373493147,
//       trait1Level: 10,
//       trait2Id: 2215087280,
//       trait2Level: 7,
//       trait3Id: 3868870292,
//       trait3Level: 5,
//       wrightstoneId: 2289754288,
//       weaponLevel: 150,
//       weaponHp: 99,
//       weaponAttack: 2285,
//     },
//     overmasteryInfo: {
//       overmasteries: [
//         { id: 3297926103, flags: 512, value: 1000 },
//         { id: 1170626407, flags: 512, value: 20 },
//         { id: 1312973931, flags: 256, value: 16 },
//         { id: 1136089117, flags: 512, value: 20 },
//       ],
//     },
//     playerStats: {
//       level: 100,
//       totalHp: 37749,
//       totalAttack: 20087,
//       stunPower: 13,
//       criticalRate: 100,
//       totalPower: 21167,
//     },
//   },
// ];

// const fullencounter = {
//   startTime: 1711656597006,
//   endTime: 1711657068436,
//   totalDamage: 267730253,
//   dps: 567910.9369365547,
//   status: "Waiting",
//   party: {
//     "403": {
//       index: 403,
//       characterType: "Pl1200",
//       totalDamage: 88189149,
//       dps: 187067.32494750016,
//       skillBreakdown: [
//         {
//           actionType: { Normal: 1100 },
//           childCharacterType: "Pl1200",
//           hits: 40,
//           minDamage: 53374,
//           maxDamage: 137752,
//           totalDamage: 3504313,
//         },
//         {
//           actionType: { SupplementaryDamage: 1100 },
//           childCharacterType: "Pl1200",
//           hits: 620,
//           minDamage: 1219,
//           maxDamage: 55102,
//           totalDamage: 13873963,
//         },
//         {
//           actionType: { Normal: 120 },
//           childCharacterType: "Pl1200",
//           hits: 248,
//           minDamage: 21427,
//           maxDamage: 275512,
//           totalDamage: 47852443,
//         },
//         {
//           actionType: { Normal: 1600 },
//           childCharacterType: "Pl1200",
//           hits: 120,
//           minDamage: 72318,
//           maxDamage: 103312,
//           totalDamage: 10682426,
//         },
//         {
//           actionType: { Normal: 1610 },
//           childCharacterType: "Pl1200",
//           hits: 15,
//           minDamage: 72318,
//           maxDamage: 103312,
//           totalDamage: 1332720,
//         },
//         {
//           actionType: { Normal: 100 },
//           childCharacterType: "Pl1200",
//           hits: 16,
//           minDamage: 13015,
//           maxDamage: 48208,
//           totalDamage: 569329,
//         },
//         {
//           actionType: { Normal: 101 },
//           childCharacterType: "Pl1200",
//           hits: 15,
//           minDamage: 13015,
//           maxDamage: 48208,
//           totalDamage: 521121,
//         },
//         {
//           actionType: { Normal: 102 },
//           childCharacterType: "Pl1200",
//           hits: 30,
//           minDamage: 13015,
//           maxDamage: 48208,
//           totalDamage: 1056705,
//         },
//         {
//           actionType: { Normal: 103 },
//           childCharacterType: "Pl1200",
//           hits: 12,
//           minDamage: 13015,
//           maxDamage: 48208,
//           totalDamage: 395781,
//         },
//         {
//           actionType: { Normal: 104 },
//           childCharacterType: "Pl1200",
//           hits: 30,
//           minDamage: 10123,
//           maxDamage: 48208,
//           totalDamage: 927504,
//         },
//         {
//           actionType: { Normal: 105 },
//           childCharacterType: "Pl1200",
//           hits: 27,
//           minDamage: 10123,
//           maxDamage: 48208,
//           totalDamage: 802164,
//         },
//         {
//           actionType: { Normal: 106 },
//           childCharacterType: "Pl1200",
//           hits: 24,
//           minDamage: 10123,
//           maxDamage: 48208,
//           totalDamage: 686466,
//         },
//         {
//           actionType: { Normal: 107 },
//           childCharacterType: "Pl1200",
//           hits: 20,
//           minDamage: 13015,
//           maxDamage: 48208,
//           totalDamage: 602105,
//         },
//         {
//           actionType: "LinkAttack",
//           childCharacterType: "Pl1200",
//           hits: 3,
//           minDamage: 482154,
//           maxDamage: 688792,
//           totalDamage: 1790858,
//         },
//         {
//           actionType: { Normal: 201 },
//           childCharacterType: "Pl1200",
//           hits: 27,
//           minDamage: 6162,
//           maxDamage: 103312,
//           totalDamage: 825711,
//         },
//         {
//           actionType: "SBA",
//           childCharacterType: "Pl1200",
//           hits: 4,
//           minDamage: 604962,
//           maxDamage: 777808,
//           totalDamage: 2765540,
//         },
//       ],
//       sba: 0,
//     },
//     "421": {
//       index: 421,
//       characterType: "Pl1400",
//       totalDamage: 44828310,
//       dps: 95090.0663937382,
//       skillBreakdown: [
//         {
//           actionType: { Normal: 1100 },
//           childCharacterType: "Pl1400",
//           hits: 2,
//           minDamage: 103458,
//           maxDamage: 114954,
//           totalDamage: 218412,
//         },
//         {
//           actionType: { SupplementaryDamage: 1100 },
//           childCharacterType: "Pl1400",
//           hits: 342,
//           minDamage: 2482,
//           maxDamage: 226078,
//           totalDamage: 4588367,
//         },
//         {
//           actionType: { Normal: 102 },
//           childCharacterType: "Pl1400",
//           hits: 36,
//           minDamage: 12412,
//           maxDamage: 45978,
//           totalDamage: 1369207,
//         },
//         {
//           actionType: { Normal: 110 },
//           childCharacterType: "Pl1400",
//           hits: 24,
//           minDamage: 12412,
//           maxDamage: 45978,
//           totalDamage: 864831,
//         },
//         {
//           actionType: { Normal: 111 },
//           childCharacterType: "Pl1400",
//           hits: 53,
//           minDamage: 12412,
//           maxDamage: 45978,
//           totalDamage: 1861615,
//         },
//         {
//           actionType: { Normal: 112 },
//           childCharacterType: "Pl1400",
//           hits: 42,
//           minDamage: 12412,
//           maxDamage: 45978,
//           totalDamage: 1458396,
//         },
//         {
//           actionType: { Normal: 113 },
//           childCharacterType: "Pl1400",
//           hits: 34,
//           minDamage: 12412,
//           maxDamage: 45978,
//           totalDamage: 1179314,
//         },
//         {
//           actionType: { Normal: 114 },
//           childCharacterType: "Pl1400",
//           hits: 31,
//           minDamage: 12412,
//           maxDamage: 45978,
//           totalDamage: 1061152,
//         },
//         {
//           actionType: { Normal: 100 },
//           childCharacterType: "Pl1400",
//           hits: 17,
//           minDamage: 12412,
//           maxDamage: 45978,
//           totalDamage: 636326,
//         },
//         {
//           actionType: { Normal: 101 },
//           childCharacterType: "Pl1400",
//           hits: 16,
//           minDamage: 12412,
//           maxDamage: 45978,
//           totalDamage: 594947,
//         },
//         {
//           actionType: { Normal: 5 },
//           childCharacterType: "Pl1400",
//           hits: 58,
//           minDamage: 42790,
//           maxDamage: 254334,
//           totalDamage: 11978081,
//         },
//         {
//           actionType: "LinkAttack",
//           childCharacterType: "Pl1400",
//           hits: 3,
//           minDamage: 402355,
//           maxDamage: 574794,
//           totalDamage: 1494463,
//         },
//         {
//           actionType: { Normal: 1000 },
//           childCharacterType: "Pl1400",
//           hits: 53,
//           minDamage: 12412,
//           maxDamage: 45978,
//           totalDamage: 1931958,
//         },
//         {
//           actionType: { Normal: 1150 },
//           childCharacterType: "Pl1400",
//           hits: 24,
//           minDamage: 15517,
//           maxDamage: 57474,
//           totalDamage: 1004632,
//         },
//         {
//           actionType: { Normal: 1109 },
//           childCharacterType: "Pl1400",
//           hits: 5,
//           minDamage: 31036,
//           maxDamage: 114954,
//           totalDamage: 387391,
//         },
//         {
//           actionType: { Normal: 1 },
//           childCharacterType: "Pl1400",
//           hits: 45,
//           minDamage: 53409,
//           maxDamage: 197814,
//           totalDamage: 6546148,
//         },
//         {
//           actionType: { Normal: 120 },
//           childCharacterType: "Pl1400",
//           hits: 74,
//           minDamage: 12412,
//           maxDamage: 45978,
//           totalDamage: 2461608,
//         },
//         {
//           actionType: { Normal: 2000 },
//           childCharacterType: "Pl1400",
//           hits: 59,
//           minDamage: 12412,
//           maxDamage: 32184,
//           totalDamage: 1602276,
//         },
//         {
//           actionType: "SBA",
//           childCharacterType: "Pl1400",
//           hits: 8,
//           minDamage: 167778,
//           maxDamage: 322212,
//           totalDamage: 2073141,
//         },
//         {
//           actionType: { Normal: 2 },
//           childCharacterType: "Pl1400",
//           hits: 2,
//           minDamage: 178735,
//           maxDamage: 1130394,
//           totalDamage: 1309129,
//         },
//         {
//           actionType: { Normal: 1103 },
//           childCharacterType: "Pl1400",
//           hits: 1,
//           minDamage: 103458,
//           maxDamage: 103458,
//           totalDamage: 103458,
//         },
//         {
//           actionType: { Normal: 1200 },
//           childCharacterType: "Pl1400",
//           hits: 1,
//           minDamage: 103458,
//           maxDamage: 103458,
//           totalDamage: 103458,
//         },
//       ],
//       sba: 0,
//     },
//     "439": {
//       index: 439,
//       characterType: "Pl0800",
//       totalDamage: 66798231,
//       dps: 141692.78790064272,
//       skillBreakdown: [
//         {
//           actionType: { Normal: 1500 },
//           childCharacterType: "Pl0800",
//           hits: 58,
//           minDamage: 208551,
//           maxDamage: 314392,
//           totalDamage: 16511172,
//         },
//         {
//           actionType: { SupplementaryDamage: 1500 },
//           childCharacterType: "Pl0800",
//           hits: 927,
//           minDamage: 1280,
//           maxDamage: 188635,
//           totalDamage: 17068099,
//         },
//         {
//           actionType: { Normal: 200 },
//           childCharacterType: "Pl0800",
//           hits: 338,
//           minDamage: 14210,
//           maxDamage: 67672,
//           totalDamage: 17181433,
//         },
//         {
//           actionType: "LinkAttack",
//           childCharacterType: "Pl0800",
//           hits: 3,
//           minDamage: 473754,
//           maxDamage: 676792,
//           totalDamage: 1759658,
//         },
//         {
//           actionType: { Normal: 100 },
//           childCharacterType: "Pl0800",
//           hits: 11,
//           minDamage: 7306,
//           maxDamage: 27064,
//           totalDamage: 182453,
//         },
//         {
//           actionType: { Normal: 101 },
//           childCharacterType: "Pl0800",
//           hits: 12,
//           minDamage: 7306,
//           maxDamage: 27064,
//           totalDamage: 207842,
//         },
//         {
//           actionType: { Normal: 102 },
//           childCharacterType: "Pl0800",
//           hits: 10,
//           minDamage: 7306,
//           maxDamage: 27064,
//           totalDamage: 169954,
//         },
//         {
//           actionType: { Normal: 103 },
//           childCharacterType: "Pl0800",
//           hits: 26,
//           minDamage: 6494,
//           maxDamage: 27064,
//           totalDamage: 534795,
//         },
//         {
//           actionType: { Normal: 104 },
//           childCharacterType: "Pl0800",
//           hits: 94,
//           minDamage: 6865,
//           maxDamage: 27064,
//           totalDamage: 1941458,
//         },
//         {
//           actionType: { Normal: 105 },
//           childCharacterType: "Pl0800",
//           hits: 90,
//           minDamage: 7142,
//           maxDamage: 27064,
//           totalDamage: 1894603,
//         },
//         {
//           actionType: { Normal: 106 },
//           childCharacterType: "Pl0800",
//           hits: 80,
//           minDamage: 7306,
//           maxDamage: 27064,
//           totalDamage: 1690318,
//         },
//         {
//           actionType: { Normal: 107 },
//           childCharacterType: "Pl0800",
//           hits: 78,
//           minDamage: 7306,
//           maxDamage: 27064,
//           totalDamage: 1638952,
//         },
//         {
//           actionType: { Normal: 108 },
//           childCharacterType: "Pl0800",
//           hits: 75,
//           minDamage: 7306,
//           maxDamage: 27064,
//           totalDamage: 1574000,
//         },
//         {
//           actionType: { Normal: 109 },
//           childCharacterType: "Pl0800",
//           hits: 66,
//           minDamage: 7306,
//           maxDamage: 27064,
//           totalDamage: 1379956,
//         },
//         {
//           actionType: "SBA",
//           childCharacterType: "Pl0800",
//           hits: 23,
//           minDamage: 39817,
//           maxDamage: 251512,
//           totalDamage: 3063538,
//         },
//       ],
//       sba: 0,
//     },
//     "456": {
//       index: 456,
//       characterType: "Pl0300",
//       totalDamage: 65330701,
//       dps: 138579.85490953058,
//       skillBreakdown: [
//         {
//           actionType: { Normal: 2 },
//           childCharacterType: "Pl0300",
//           hits: 108,
//           minDamage: 32569,
//           maxDamage: 46528,
//           totalDamage: 4536459,
//         },
//         {
//           actionType: { SupplementaryDamage: 2 },
//           childCharacterType: "Pl0300",
//           hits: 1312,
//           minDamage: 618,
//           maxDamage: 61342,
//           totalDamage: 10081032,
//         },
//         {
//           actionType: { Normal: 100 },
//           childCharacterType: "Pl0300",
//           hits: 252,
//           minDamage: 3586,
//           maxDamage: 14727,
//           totalDamage: 2987114,
//         },
//         {
//           actionType: { Normal: 105 },
//           childCharacterType: "Pl0300",
//           hits: 698,
//           minDamage: 3619,
//           maxDamage: 36831,
//           totalDamage: 20596333,
//         },
//         {
//           actionType: "LinkAttack",
//           childCharacterType: "Pl0300",
//           hits: 31,
//           minDamage: 51570,
//           maxDamage: 73671,
//           totalDamage: 1989111,
//         },
//         {
//           actionType: { Normal: 205 },
//           childCharacterType: "Pl0300",
//           hits: 53,
//           minDamage: 75757,
//           maxDamage: 306711,
//           totalDamage: 11248363,
//         },
//         {
//           actionType: { Normal: 1 },
//           childCharacterType: "Pl0300",
//           hits: 18,
//           minDamage: 209406,
//           maxDamage: 299152,
//           totalDamage: 4846256,
//         },
//         {
//           actionType: "SBA",
//           childCharacterType: "Pl0300",
//           hits: 14,
//           minDamage: 92905,
//           maxDamage: 269236,
//           totalDamage: 2250583,
//         },
//         {
//           actionType: { Normal: 5 },
//           childCharacterType: "Pl0300",
//           hits: 201,
//           minDamage: 27915,
//           maxDamage: 39880,
//           totalDamage: 6795450,
//         },
//       ],
//       sba: 0,
//     },
//     "474": {
//       index: 474,
//       characterType: "Pl2100",
//       totalDamage: 2583862,
//       dps: 5480.902785143076,
//       skillBreakdown: [
//         {
//           actionType: { Normal: 1300 },
//           childCharacterType: "Pl2100",
//           hits: 48,
//           minDamage: 14329,
//           maxDamage: 33838,
//           totalDamage: 977409,
//         },
//         {
//           actionType: { Normal: 1000 },
//           childCharacterType: "Pl2100",
//           hits: 38,
//           minDamage: 14403,
//           maxDamage: 30156,
//           totalDamage: 783598,
//         },
//         {
//           actionType: { Normal: 1100 },
//           childCharacterType: "Pl2100",
//           hits: 43,
//           minDamage: 4275,
//           maxDamage: 32744,
//           totalDamage: 659958,
//         },
//         {
//           actionType: { Normal: 0 },
//           childCharacterType: "Pl2100",
//           hits: 6,
//           minDamage: 19125,
//           maxDamage: 22011,
//           totalDamage: 122158,
//         },
//         {
//           actionType: "LinkAttack",
//           childCharacterType: "Pl2100",
//           hits: 2,
//           minDamage: 18644,
//           maxDamage: 22095,
//           totalDamage: 40739,
//         },
//       ],
//       sba: 0,
//     },
//   },
//   targets: {
//     "511": {
//       index: 511,
//       targetType: { Unknown: 724657483 },
//       rawTargetType: 724657483,
//       totalDamage: 244189913,
//     },
//     "516": {
//       index: 516,
//       targetType: { Unknown: 3566538100 },
//       rawTargetType: 3566538100,
//       totalDamage: 4475889,
//     },
//     "520": {
//       index: 520,
//       targetType: { Unknown: 3566538100 },
//       rawTargetType: 3566538100,
//       totalDamage: 8513693,
//     },
//     "524": {
//       index: 524,
//       targetType: { Unknown: 3566538100 },
//       rawTargetType: 3566538100,
//       totalDamage: 6995827,
//     },
//     "537": {
//       index: 537,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 431809,
//     },
//     "544": {
//       index: 544,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 274861,
//     },
//     "563": {
//       index: 563,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 422994,
//     },
//     "566": {
//       index: 566,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 233968,
//     },
//     "567": {
//       index: 567,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 233968,
//     },
//     "571": {
//       index: 571,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 221755,
//     },
//     "572": {
//       index: 572,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 210338,
//     },
//     "573": {
//       index: 573,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 219067,
//     },
//     "574": {
//       index: 574,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 214459,
//     },
//     "577": {
//       index: 577,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 232710,
//     },
//     "578": {
//       index: 578,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 414947,
//     },
//     "579": {
//       index: 579,
//       targetType: { Unknown: 933702529 },
//       rawTargetType: 933702529,
//       totalDamage: 444055,
//     },
//   },
// };
